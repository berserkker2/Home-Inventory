<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üè† Home Inventory</title>
</head>
<body style="font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px;">

  <h1>üè† Home Inventory</h1>
  <div id="itemsContainer"></div>

  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDr4R8rVOzVGgPMyPFJoAAJ8MF0RRL9wXc",
      authDomain: "home-inventory-ac0d4.firebaseapp.com",
      projectId: "home-inventory-ac0d4",
      storageBucket: "home-inventory-ac0d4.firebasestorage.app",
      messagingSenderId: "227724333061",
      appId: "1:227724333061:web:7e1068a9ac884fb9f0cc6c"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Load and display items
    async function loadItems() {
      const querySnapshot = await getDocs(collection(db, "items"));
      const itemsByType = {};

      querySnapshot.forEach((docSnap) => {
        const item = docSnap.data();
        const id = docSnap.id;
        const type = item.type || "Other";

        if (!itemsByType[type]) itemsByType[type] = [];
        itemsByType[type].push({ ...item, id });
      });

      const container = document.getElementById("itemsContainer");
      container.innerHTML = "";

      for (const [type, items] of Object.entries(itemsByType)) {
        const section = document.createElement("div");
        section.innerHTML = `<h2>${type}</h2>`;

        items.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.style = "margin:10px;padding:10px;border:1px solid #ccc;border-radius:10px;";

          const img = `<img src="${item.imageURL}" style="width:100px;height:100px;object-fit:cover;"><br>`;

          const nameSpan = `<span id="name-${item.id}">${item.name}</span>`;
          const qtySpan = `<span id="qty-${item.id}">${item.quantity}</span>`;
          const editButton = `<button onclick="editItem('${item.id}', '${item.name}', ${item.quantity})">‚úèÔ∏è Edit</button>`;

          itemDiv.innerHTML = img + `<strong>${nameSpan}</strong><br>Quantity: ${qtySpan}<br>` + editButton;
          section.appendChild(itemDiv);
        });

        container.appendChild(section);
      }
    }

    // Edit an item inline
    window.editItem = async function (id, currentName, currentQty) {
      const nameEl = document.getElementById(`name-${id}`);
      const qtyEl = document.getElementById(`qty-${id}`);

      nameEl.innerHTML = `<input type="text" id="input-name-${id}" value="${currentName}">`;
      qtyEl.innerHTML = `<input type="number" id="input-qty-${id}" value="${currentQty}">`;

      const button = nameEl.parentElement.querySelector("button");
      button.textContent = "üíæ Save";
      button.onclick = async () => {
        const newName = document.getElementById(`input-name-${id}`).value;
        const newQty = parseInt(document.getElementById(`input-qty-${id}`).value);

        const itemRef = doc(db, "items", id);
        await updateDoc(itemRef, {
          name: newName,
          quantity: newQty
        });

        loadItems(); // refresh the UI
      };
    }

    // Load the items on page load
    loadItems();
  </script>

</body>
</html>
